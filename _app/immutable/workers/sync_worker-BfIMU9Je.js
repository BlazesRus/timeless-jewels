(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const O=Symbol("Comlink.proxy"),G=Symbol("Comlink.endpoint"),V=Symbol("Comlink.releaseProxy"),x=Symbol("Comlink.finalizer"),p=Symbol("Comlink.thrown"),P=t=>typeof t=="object"&&t!==null||typeof t=="function",B={canHandle:t=>P(t)&&t[O],serialize(t){const{port1:i,port2:l}=new MessageChannel;return _(t,i),[l,[l]]},deserialize(t){return t.start(),z(t)}},F={canHandle:t=>P(t)&&p in t,serialize({value:t}){let i;return t instanceof Error?i={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:i={isError:!1,value:t},[i,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},I=new Map([["proxy",B],["throw",F]]);function L(t,i){for(const l of t)if(i===l||l==="*"||l instanceof RegExp&&l.test(i))return!0;return!1}function _(t,i=globalThis,l=["*"]){i.addEventListener("message",function c(r){if(!r||!r.data)return;if(!L(l,r.origin)){console.warn(`Invalid origin '${r.origin}' for comlink proxy`);return}const{id:s,type:a,path:o}=Object.assign({path:[]},r.data),d=(r.data.argumentList||[]).map(w);let h;try{const g=o.slice(0,-1).reduce((n,u)=>n[u],t),e=o.reduce((n,u)=>n[u],t);switch(a){case"GET":h=e;break;case"SET":g[o.slice(-1)[0]]=w(r.data.value),h=!0;break;case"APPLY":h=e.apply(g,d);break;case"CONSTRUCT":{const n=new e(...d);h=X(n)}break;case"ENDPOINT":{const{port1:n,port2:u}=new MessageChannel;_(t,u),h=$(n,[n])}break;case"RELEASE":h=void 0;break;default:return}}catch(g){h={value:g,[p]:0}}Promise.resolve(h).catch(g=>({value:g,[p]:0})).then(g=>{const[e,n]=v(g);i.postMessage(Object.assign(Object.assign({},e),{id:s}),n),a==="RELEASE"&&(i.removeEventListener("message",c),A(i),x in t&&typeof t[x]=="function"&&t[x]())}).catch(g=>{const[e,n]=v({value:new TypeError("Unserializable return value"),[p]:0});i.postMessage(Object.assign(Object.assign({},e),{id:s}),n)})}),i.start&&i.start()}function W(t){return t.constructor.name==="MessagePort"}function A(t){W(t)&&t.close()}function z(t,i){const l=new Map;return t.addEventListener("message",function(r){const{data:s}=r;if(!s||!s.id)return;const a=l.get(s.id);if(a)try{a(s)}finally{l.delete(s.id)}}),j(t,l,[],i)}function S(t){if(t)throw new Error("Proxy has been released and is not useable")}function R(t){return T(t,new Map,{type:"RELEASE"}).then(()=>{A(t)})}const k=new WeakMap,E="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const i=(k.get(t)||0)-1;k.set(t,i),i===0&&R(t)});function H(t,i){const l=(k.get(i)||0)+1;k.set(i,l),E&&E.register(t,i,t)}function q(t){E&&E.unregister(t)}function j(t,i,l=[],c=function(){}){let r=!1;const s=new Proxy(c,{get(a,o){if(S(r),o===V)return()=>{q(s),R(t),i.clear(),r=!0};if(o==="then"){if(l.length===0)return{then:()=>s};const d=T(t,i,{type:"GET",path:l.map(h=>h.toString())}).then(w);return d.then.bind(d)}return j(t,i,[...l,o])},set(a,o,d){S(r);const[h,g]=v(d);return T(t,i,{type:"SET",path:[...l,o].map(e=>e.toString()),value:h},g).then(w)},apply(a,o,d){S(r);const h=l[l.length-1];if(h===G)return T(t,i,{type:"ENDPOINT"}).then(w);if(h==="bind")return j(t,i,l.slice(0,-1));const[g,e]=C(d);return T(t,i,{type:"APPLY",path:l.map(n=>n.toString()),argumentList:g},e).then(w)},construct(a,o){S(r);const[d,h]=C(o);return T(t,i,{type:"CONSTRUCT",path:l.map(g=>g.toString()),argumentList:d},h).then(w)}});return H(s,t),s}function Y(t){return Array.prototype.concat.apply([],t)}function C(t){const i=t.map(v);return[i.map(l=>l[0]),Y(i.map(l=>l[1]))]}const U=new WeakMap;function $(t,i){return U.set(t,i),t}function X(t){return Object.assign(t,{[O]:!0})}function v(t){for(const[i,l]of I)if(l.canHandle(t)){const[c,r]=l.serialize(t);return[{type:"HANDLER",name:i,value:c},r]}return[{type:"RAW",value:t},U.get(t)||[]]}function w(t){switch(t.type){case"HANDLER":return I.get(t.name).deserialize(t.value);case"RAW":return t.value}}function T(t,i,l,c){return new Promise(r=>{const s=K();i.set(s,r),t.start&&t.start(),t.postMessage(Object.assign({id:s},l),c)})}function K(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}(()=>{const t=()=>{const c=new Error("not implemented");return c.code="ENOSYS",c};if(!globalThis.fs){let c="";globalThis.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(r,s){c+=l.decode(s);const a=c.lastIndexOf(`
`);return a!=-1&&(console.log(c.substring(0,a)),c=c.substring(a+1)),s.length},write(r,s,a,o,d,h){if(a!==0||o!==s.length||d!==null){h(t());return}const g=this.writeSync(r,s);h(null,g)},chmod(r,s,a){a(t())},chown(r,s,a,o){o(t())},close(r,s){s(t())},fchmod(r,s,a){a(t())},fchown(r,s,a,o){o(t())},fstat(r,s){s(t())},fsync(r,s){s(null)},ftruncate(r,s,a){a(t())},lchown(r,s,a,o){o(t())},link(r,s,a){a(t())},lstat(r,s){s(t())},mkdir(r,s,a){a(t())},open(r,s,a,o){o(t())},read(r,s,a,o,d,h){h(t())},readdir(r,s){s(t())},readlink(r,s){s(t())},rename(r,s,a){a(t())},rmdir(r,s){s(t())},stat(r,s){s(t())},symlink(r,s,a){a(t())},truncate(r,s,a){a(t())},unlink(r,s){s(t())},utimes(r,s,a,o){o(t())}}}if(globalThis.process||(globalThis.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw t()},pid:-1,ppid:-1,umask(){throw t()},cwd(){throw t()},chdir(){throw t()}}),!globalThis.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!globalThis.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!globalThis.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!globalThis.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const i=new TextEncoder("utf-8"),l=new TextDecoder("utf-8");globalThis.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=e=>{e!==0&&console.warn("exit code:",e)},this._exitPromise=new Promise(e=>{this._resolveExitPromise=e}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const c=(e,n)=>{this.mem.setUint32(e+0,n,!0),this.mem.setUint32(e+4,Math.floor(n/4294967296),!0)},r=e=>{const n=this.mem.getUint32(e+0,!0),u=this.mem.getInt32(e+4,!0);return n+u*4294967296},s=e=>{const n=this.mem.getFloat64(e,!0);if(n===0)return;if(!isNaN(n))return n;const u=this.mem.getUint32(e,!0);return this._values[u]},a=(e,n)=>{if(typeof n=="number"&&n!==0){if(isNaN(n)){this.mem.setUint32(e+4,2146959360,!0),this.mem.setUint32(e,0,!0);return}this.mem.setFloat64(e,n,!0);return}if(n===void 0){this.mem.setFloat64(e,0,!0);return}let m=this._ids.get(n);m===void 0&&(m=this._idPool.pop(),m===void 0&&(m=this._values.length),this._values[m]=n,this._goRefCounts[m]=0,this._ids.set(n,m)),this._goRefCounts[m]++;let y=0;switch(typeof n){case"object":n!==null&&(y=1);break;case"string":y=2;break;case"symbol":y=3;break;case"function":y=4;break}this.mem.setUint32(e+4,2146959360|y,!0),this.mem.setUint32(e,m,!0)},o=e=>{const n=r(e+0),u=r(e+8);return new Uint8Array(this._inst.exports.mem.buffer,n,u)},d=e=>{const n=r(e+0),u=r(e+8),m=new Array(u);for(let y=0;y<u;y++)m[y]=s(n+y*8);return m},h=e=>{const n=r(e+0),u=r(e+8);return l.decode(new DataView(this._inst.exports.mem.buffer,n,u))},g=Date.now()-performance.now();this.importObject={_gotest:{add:(e,n)=>e+n},gojs:{"runtime.wasmExit":e=>{e>>>=0;const n=this.mem.getInt32(e+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(n)},"runtime.wasmWrite":e=>{e>>>=0;const n=r(e+8),u=r(e+16),m=this.mem.getInt32(e+24,!0);fs.writeSync(n,new Uint8Array(this._inst.exports.mem.buffer,u,m))},"runtime.resetMemoryDataView":e=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":e=>{e>>>=0,c(e+8,(g+performance.now())*1e6)},"runtime.walltime":e=>{e>>>=0;const n=new Date().getTime();c(e+8,n/1e3),this.mem.setInt32(e+16,n%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":e=>{e>>>=0;const n=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(n,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(n);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},r(e+8))),this.mem.setInt32(e+16,n,!0)},"runtime.clearTimeoutEvent":e=>{e>>>=0;const n=this.mem.getInt32(e+8,!0);clearTimeout(this._scheduledTimeouts.get(n)),this._scheduledTimeouts.delete(n)},"runtime.getRandomData":e=>{e>>>=0,crypto.getRandomValues(o(e+8))},"syscall/js.finalizeRef":e=>{e>>>=0;const n=this.mem.getUint32(e+8,!0);if(this._goRefCounts[n]--,this._goRefCounts[n]===0){const u=this._values[n];this._values[n]=null,this._ids.delete(u),this._idPool.push(n)}},"syscall/js.stringVal":e=>{e>>>=0,a(e+24,h(e+8))},"syscall/js.valueGet":e=>{e>>>=0;const n=Reflect.get(s(e+8),h(e+16));e=this._inst.exports.getsp()>>>0,a(e+32,n)},"syscall/js.valueSet":e=>{e>>>=0,Reflect.set(s(e+8),h(e+16),s(e+32))},"syscall/js.valueDelete":e=>{e>>>=0,Reflect.deleteProperty(s(e+8),h(e+16))},"syscall/js.valueIndex":e=>{e>>>=0,a(e+24,Reflect.get(s(e+8),r(e+16)))},"syscall/js.valueSetIndex":e=>{e>>>=0,Reflect.set(s(e+8),r(e+16),s(e+24))},"syscall/js.valueCall":e=>{e>>>=0;try{const n=s(e+8),u=Reflect.get(n,h(e+16)),m=d(e+32),y=Reflect.apply(u,n,m);e=this._inst.exports.getsp()>>>0,a(e+56,y),this.mem.setUint8(e+64,1)}catch(n){e=this._inst.exports.getsp()>>>0,a(e+56,n),this.mem.setUint8(e+64,0)}},"syscall/js.valueInvoke":e=>{e>>>=0;try{const n=s(e+8),u=d(e+16),m=Reflect.apply(n,void 0,u);e=this._inst.exports.getsp()>>>0,a(e+40,m),this.mem.setUint8(e+48,1)}catch(n){e=this._inst.exports.getsp()>>>0,a(e+40,n),this.mem.setUint8(e+48,0)}},"syscall/js.valueNew":e=>{e>>>=0;try{const n=s(e+8),u=d(e+16),m=Reflect.construct(n,u);e=this._inst.exports.getsp()>>>0,a(e+40,m),this.mem.setUint8(e+48,1)}catch(n){e=this._inst.exports.getsp()>>>0,a(e+40,n),this.mem.setUint8(e+48,0)}},"syscall/js.valueLength":e=>{e>>>=0,c(e+16,parseInt(s(e+8).length))},"syscall/js.valuePrepareString":e=>{e>>>=0;const n=i.encode(String(s(e+8)));a(e+16,n),c(e+24,n.length)},"syscall/js.valueLoadString":e=>{e>>>=0;const n=s(e+8);o(e+16).set(n)},"syscall/js.valueInstanceOf":e=>{e>>>=0,this.mem.setUint8(e+24,s(e+8)instanceof s(e+16)?1:0)},"syscall/js.copyBytesToGo":e=>{e>>>=0;const n=o(e+8),u=s(e+32);if(!(u instanceof Uint8Array||u instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const m=u.subarray(0,n.length);n.set(m),c(e+40,m.length),this.mem.setUint8(e+48,1)},"syscall/js.copyBytesToJS":e=>{e>>>=0;const n=s(e+8),u=o(e+16);if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const m=u.subarray(0,n.length);n.set(m),c(e+40,m.length),this.mem.setUint8(e+48,1)},debug:e=>{console.log(e)}}}}async run(c){if(!(c instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=c,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,globalThis,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[globalThis,5],[this,6]]),this._idPool=[],this.exited=!1;let r=4096;const s=e=>{const n=r,u=i.encode(e+"\0");return new Uint8Array(this.mem.buffer,r,u.length).set(u),r+=u.length,r%8!==0&&(r+=8-r%8),n},a=this.argv.length,o=[];this.argv.forEach(e=>{o.push(s(e))}),o.push(0),Object.keys(this.env).sort().forEach(e=>{o.push(s(`${e}=${this.env[e]}`))}),o.push(0);const h=r;if(o.forEach(e=>{this.mem.setUint32(r,e,!0),this.mem.setUint32(r+4,0,!0),r+=8}),r>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(a,h),this.exited&&this._resolveExitPromise(),await this._exitPromise}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(c){const r=this;return function(){const s={id:c,this:this,args:arguments};return r._pendingEvent=s,r._resume(),s.result}}}})();let N,b;const Q=()=>{N={Calculate:globalThis.go["timeless-jewels"].calculator.Calculate,ReverseSearch:globalThis.go["timeless-jewels"].calculator.ReverseSearch},b={GetAlternatePassiveAdditionByIndex:globalThis.go["timeless-jewels"].data.GetAlternatePassiveAdditionByIndex,GetAlternatePassiveSkillByIndex:globalThis.go["timeless-jewels"].data.GetAlternatePassiveSkillByIndex,GetPassiveSkillByIndex:globalThis.go["timeless-jewels"].data.GetPassiveSkillByIndex,GetStatByIndex:globalThis.go["timeless-jewels"].data.GetStatByIndex,PassiveSkillAuraStatTranslationsJSON:globalThis.go["timeless-jewels"].data.PassiveSkillAuraStatTranslationsJSON,PassiveSkillStatTranslationsJSON:globalThis.go["timeless-jewels"].data.PassiveSkillStatTranslationsJSON,PassiveSkills:globalThis.go["timeless-jewels"].data.PassiveSkills,PossibleStats:globalThis.go["timeless-jewels"].data.PossibleStats,SkillTree:globalThis.go["timeless-jewels"].data.SkillTree,StatTranslationsJSON:globalThis.go["timeless-jewels"].data.StatTranslationsJSON,TimelessJewelConquerors:globalThis.go["timeless-jewels"].data.TimelessJewelConquerors,TimelessJewelSeedRanges:globalThis.go["timeless-jewels"].data.TimelessJewelSeedRanges,TimelessJewels:globalThis.go["timeless-jewels"].data.TimelessJewels,TreeToPassive:globalThis.go["timeless-jewels"].data.TreeToPassive}};let f;const M={},Z=()=>{f=JSON.parse(b.SkillTree),console.log("Loaded skill tree",f),Object.keys(f.groups).forEach(i=>{f.groups[i].nodes.forEach(c=>{const r=f.nodes[c];r.isProxy||"classStartIndex"in r||r.expansionJewel&&r.expansionJewel.parent||r.isBlighted||r.ascendancyName})}),Object.keys(f.sprites.keystoneInactive["0.3835"].coords).forEach(i=>f.sprites.keystoneInactive["0.3835"]),Object.keys(f.sprites.notableInactive["0.3835"].coords).forEach(i=>f.sprites.notableInactive["0.3835"]),Object.keys(f.sprites.normalInactive["0.3835"].coords).forEach(i=>f.sprites.normalInactive["0.3835"]),Object.keys(f.sprites.masteryInactive["0.3835"].coords).forEach(i=>f.sprites.masteryInactive["0.3835"]),Object.keys(f.sprites.keystoneActive["0.3835"].coords).forEach(i=>f.sprites.keystoneActive["0.3835"]),Object.keys(f.sprites.notableActive["0.3835"].coords).forEach(i=>f.sprites.notableActive["0.3835"]),Object.keys(f.sprites.normalActive["0.3835"].coords).forEach(i=>f.sprites.normalActive["0.3835"]),Object.keys(f.sprites.masteryInactive["0.3835"].coords).forEach(i=>f.sprites.masteryInactive["0.3835"]),Object.keys(f.sprites.groupBackground["0.3835"].coords).forEach(i=>f.sprites.groupBackground["0.3835"]),Object.keys(f.sprites.frame["0.3835"].coords).forEach(i=>f.sprites.frame["0.3835"]),[b.StatTranslationsJSON,b.PassiveSkillStatTranslationsJSON,b.PassiveSkillAuraStatTranslationsJSON].forEach(i=>{JSON.parse(i).descriptors.forEach(c=>{c.ids.forEach(r=>{})})}),Object.keys(b.TreeToPassive).forEach(i=>{M[b.TreeToPassive[parseInt(i)].Index]=parseInt(i)})};_({boot(t){const i=new Go;WebAssembly.instantiate(t,i.importObject).then(l=>{i.run(l.instance),Q(),Z()})},async search(t,i){const l=await N.ReverseSearch(t.nodes,t.stats.map(r=>r.id),t.jewel,t.conqueror,i),c={};return Object.keys(l).forEach(r=>{const s=parseInt(r);let a=0,o=0;const d={},h={},g=Object.keys(l[s]).map(n=>{const u=parseInt(n);return Object.keys(l[s][u]).forEach(m=>{var J;const y=parseInt(m);d[y]=(d[y]||0)+1,a+=((J=t.stats.find(ee=>ee.id==y))==null?void 0:J.weight)||0;const D=skillStats[m];h[y]=(h[y]??0)+D,o+=D}),{passive:M[u],stats:l[s][u]}}),e=Object.keys(l[s]).length;c[e]=[...c[e]||[],{skills:g,seed:s,weight:a,statCounts:d,statTotal:h,totalStats:o}]}),Object.keys(c).forEach(r=>{const s=parseInt(r);c[s]=c[s].filter(a=>{if(a.weight<t.minTotalWeight)return!1;for(const o of t.stats)if(a.statCounts[o.id]===void 0&&o.min>0||a.statCounts[o.id]<o.min||a.statTotal[o.id]<o.minStatTotal)return!1;return!(a.totalStats<t.minTotalStats)}),Object.keys(c[s]).length==0?delete c[s]:c[s]=c[s].sort((a,o)=>o.weight-a.weight)}),{grouped:c,raw:Object.keys(c).map(r=>c[parseInt(r)]).flat().sort((r,s)=>s.weight-r.weight)}}})})();
