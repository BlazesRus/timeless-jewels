(function(){"use strict";const k=Symbol("Comlink.proxy"),I=Symbol("Comlink.endpoint"),U=Symbol("Comlink.releaseProxy"),p=Symbol("Comlink.thrown"),v=t=>typeof t=="object"&&t!==null||typeof t=="function",A={canHandle:t=>v(t)&&t[k],serialize(t){const{port1:c,port2:h}=new MessageChannel;return _(t,c),[h,[h]]},deserialize(t){return t.start(),L(t)}},C={canHandle:t=>v(t)&&p in t,serialize({value:t}){let c;return t instanceof Error?c={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:c={isError:!1,value:t},[c,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},S=new Map([["proxy",A],["throw",C]]);function _(t,c=self){c.addEventListener("message",function h(a){if(!a||!a.data)return;const{id:s,type:n,path:i}=Object.assign({path:[]},a.data),o=(a.data.argumentList||[]).map(w);let f;try{const u=i.slice(0,-1).reduce((e,r)=>e[r],t),d=i.reduce((e,r)=>e[r],t);switch(n){case"GET":f=d;break;case"SET":u[i.slice(-1)[0]]=w(a.data.value),f=!0;break;case"APPLY":f=d.apply(u,o);break;case"CONSTRUCT":{const e=new d(...o);f=V(e)}break;case"ENDPOINT":{const{port1:e,port2:r}=new MessageChannel;_(t,r),f=M(e,[e])}break;case"RELEASE":f=void 0;break;default:return}}catch(u){f={value:u,[p]:0}}Promise.resolve(f).catch(u=>({value:u,[p]:0})).then(u=>{const[d,e]=x(u);c.postMessage(Object.assign(Object.assign({},d),{id:s}),e),n==="RELEASE"&&(c.removeEventListener("message",h),j(c))})}),c.start&&c.start()}function N(t){return t.constructor.name==="MessagePort"}function j(t){N(t)&&t.close()}function L(t,c){return T(t,[],c)}function E(t){if(t)throw new Error("Proxy has been released and is not useable")}function T(t,c=[],h=function(){}){let a=!1;const s=new Proxy(h,{get(n,i){if(E(a),i===U)return()=>b(t,{type:"RELEASE",path:c.map(o=>o.toString())}).then(()=>{j(t),a=!0});if(i==="then"){if(c.length===0)return{then:()=>s};const o=b(t,{type:"GET",path:c.map(f=>f.toString())}).then(w);return o.then.bind(o)}return T(t,[...c,i])},set(n,i,o){E(a);const[f,u]=x(o);return b(t,{type:"SET",path:[...c,i].map(d=>d.toString()),value:f},u).then(w)},apply(n,i,o){E(a);const f=c[c.length-1];if(f===I)return b(t,{type:"ENDPOINT"}).then(w);if(f==="bind")return T(t,c.slice(0,-1));const[u,d]=O(o);return b(t,{type:"APPLY",path:c.map(e=>e.toString()),argumentList:u},d).then(w)},construct(n,i){E(a);const[o,f]=O(i);return b(t,{type:"CONSTRUCT",path:c.map(u=>u.toString()),argumentList:o},f).then(w)}});return s}function D(t){return Array.prototype.concat.apply([],t)}function O(t){const c=t.map(x);return[c.map(h=>h[0]),D(c.map(h=>h[1]))]}const P=new WeakMap;function M(t,c){return P.set(t,c),t}function V(t){return Object.assign(t,{[k]:!0})}function x(t){for(const[c,h]of S)if(h.canHandle(t)){const[a,s]=h.serialize(t);return[{type:"HANDLER",name:c,value:a},s]}return[{type:"RAW",value:t},P.get(t)||[]]}function w(t){switch(t.type){case"HANDLER":return S.get(t.name).deserialize(t.value);case"RAW":return t.value}}function b(t,c,h){return new Promise(a=>{const s=W();t.addEventListener("message",function n(i){!i.data||!i.data.id||i.data.id!==s||(t.removeEventListener("message",n),a(i.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},c),h)})}function W(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}(()=>{const t=()=>{const a=new Error("not implemented");return a.code="ENOSYS",a};if(!globalThis.fs){let a="";globalThis.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(s,n){a+=h.decode(n);const i=a.lastIndexOf(`
`);return i!=-1&&(console.log(a.substr(0,i)),a=a.substr(i+1)),n.length},write(s,n,i,o,f,u){if(i!==0||o!==n.length||f!==null){u(t());return}const d=this.writeSync(s,n);u(null,d)},chmod(s,n,i){i(t())},chown(s,n,i,o){o(t())},close(s,n){n(t())},fchmod(s,n,i){i(t())},fchown(s,n,i,o){o(t())},fstat(s,n){n(t())},fsync(s,n){n(null)},ftruncate(s,n,i){i(t())},lchown(s,n,i,o){o(t())},link(s,n,i){i(t())},lstat(s,n){n(t())},mkdir(s,n,i){i(t())},open(s,n,i,o){o(t())},read(s,n,i,o,f,u){u(t())},readdir(s,n){n(t())},readlink(s,n){n(t())},rename(s,n,i){i(t())},rmdir(s,n){n(t())},stat(s,n){n(t())},symlink(s,n,i){i(t())},truncate(s,n,i){i(t())},unlink(s,n){n(t())},utimes(s,n,i,o){o(t())}}}if(globalThis.process||(globalThis.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw t()},pid:-1,ppid:-1,umask(){throw t()},cwd(){throw t()},chdir(){throw t()}}),!globalThis.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!globalThis.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!globalThis.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!globalThis.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const c=new TextEncoder("utf-8"),h=new TextDecoder("utf-8");globalThis.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=e=>{e!==0&&console.warn("exit code:",e)},this._exitPromise=new Promise(e=>{this._resolveExitPromise=e}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const a=(e,r)=>{this.mem.setUint32(e+0,r,!0),this.mem.setUint32(e+4,Math.floor(r/4294967296),!0)},s=e=>{const r=this.mem.getUint32(e+0,!0),l=this.mem.getInt32(e+4,!0);return r+l*4294967296},n=e=>{const r=this.mem.getFloat64(e,!0);if(r===0)return;if(!isNaN(r))return r;const l=this.mem.getUint32(e,!0);return this._values[l]},i=(e,r)=>{if(typeof r=="number"&&r!==0){if(isNaN(r)){this.mem.setUint32(e+4,2146959360,!0),this.mem.setUint32(e,0,!0);return}this.mem.setFloat64(e,r,!0);return}if(r===void 0){this.mem.setFloat64(e,0,!0);return}let m=this._ids.get(r);m===void 0&&(m=this._idPool.pop(),m===void 0&&(m=this._values.length),this._values[m]=r,this._goRefCounts[m]=0,this._ids.set(r,m)),this._goRefCounts[m]++;let y=0;switch(typeof r){case"object":r!==null&&(y=1);break;case"string":y=2;break;case"symbol":y=3;break;case"function":y=4;break}this.mem.setUint32(e+4,2146959360|y,!0),this.mem.setUint32(e,m,!0)},o=e=>{const r=s(e+0),l=s(e+8);return new Uint8Array(this._inst.exports.mem.buffer,r,l)},f=e=>{const r=s(e+0),l=s(e+8),m=new Array(l);for(let y=0;y<l;y++)m[y]=n(r+y*8);return m},u=e=>{const r=s(e+0),l=s(e+8);return h.decode(new DataView(this._inst.exports.mem.buffer,r,l))},d=Date.now()-performance.now();this.importObject={go:{"runtime.wasmExit":e=>{e>>>=0;const r=this.mem.getInt32(e+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(r)},"runtime.wasmWrite":e=>{e>>>=0;const r=s(e+8),l=s(e+16),m=this.mem.getInt32(e+24,!0);fs.writeSync(r,new Uint8Array(this._inst.exports.mem.buffer,l,m))},"runtime.resetMemoryDataView":e=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":e=>{e>>>=0,a(e+8,(d+performance.now())*1e6)},"runtime.walltime":e=>{e>>>=0;const r=new Date().getTime();a(e+8,r/1e3),this.mem.setInt32(e+16,r%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":e=>{e>>>=0;const r=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(r,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(r);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},s(e+8)+1)),this.mem.setInt32(e+16,r,!0)},"runtime.clearTimeoutEvent":e=>{e>>>=0;const r=this.mem.getInt32(e+8,!0);clearTimeout(this._scheduledTimeouts.get(r)),this._scheduledTimeouts.delete(r)},"runtime.getRandomData":e=>{e>>>=0,crypto.getRandomValues(o(e+8))},"syscall/js.finalizeRef":e=>{e>>>=0;const r=this.mem.getUint32(e+8,!0);if(this._goRefCounts[r]--,this._goRefCounts[r]===0){const l=this._values[r];this._values[r]=null,this._ids.delete(l),this._idPool.push(r)}},"syscall/js.stringVal":e=>{e>>>=0,i(e+24,u(e+8))},"syscall/js.valueGet":e=>{e>>>=0;const r=Reflect.get(n(e+8),u(e+16));e=this._inst.exports.getsp()>>>0,i(e+32,r)},"syscall/js.valueSet":e=>{e>>>=0,Reflect.set(n(e+8),u(e+16),n(e+32))},"syscall/js.valueDelete":e=>{e>>>=0,Reflect.deleteProperty(n(e+8),u(e+16))},"syscall/js.valueIndex":e=>{e>>>=0,i(e+24,Reflect.get(n(e+8),s(e+16)))},"syscall/js.valueSetIndex":e=>{e>>>=0,Reflect.set(n(e+8),s(e+16),n(e+24))},"syscall/js.valueCall":e=>{e>>>=0;try{const r=n(e+8),l=Reflect.get(r,u(e+16)),m=f(e+32),y=Reflect.apply(l,r,m);e=this._inst.exports.getsp()>>>0,i(e+56,y),this.mem.setUint8(e+64,1)}catch(r){e=this._inst.exports.getsp()>>>0,i(e+56,r),this.mem.setUint8(e+64,0)}},"syscall/js.valueInvoke":e=>{e>>>=0;try{const r=n(e+8),l=f(e+16),m=Reflect.apply(r,void 0,l);e=this._inst.exports.getsp()>>>0,i(e+40,m),this.mem.setUint8(e+48,1)}catch(r){e=this._inst.exports.getsp()>>>0,i(e+40,r),this.mem.setUint8(e+48,0)}},"syscall/js.valueNew":e=>{e>>>=0;try{const r=n(e+8),l=f(e+16),m=Reflect.construct(r,l);e=this._inst.exports.getsp()>>>0,i(e+40,m),this.mem.setUint8(e+48,1)}catch(r){e=this._inst.exports.getsp()>>>0,i(e+40,r),this.mem.setUint8(e+48,0)}},"syscall/js.valueLength":e=>{e>>>=0,a(e+16,parseInt(n(e+8).length))},"syscall/js.valuePrepareString":e=>{e>>>=0;const r=c.encode(String(n(e+8)));i(e+16,r),a(e+24,r.length)},"syscall/js.valueLoadString":e=>{e>>>=0;const r=n(e+8);o(e+16).set(r)},"syscall/js.valueInstanceOf":e=>{e>>>=0,this.mem.setUint8(e+24,n(e+8)instanceof n(e+16)?1:0)},"syscall/js.copyBytesToGo":e=>{e>>>=0;const r=o(e+8),l=n(e+32);if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const m=l.subarray(0,r.length);r.set(m),a(e+40,m.length),this.mem.setUint8(e+48,1)},"syscall/js.copyBytesToJS":e=>{e>>>=0;const r=n(e+8),l=o(e+16);if(!(r instanceof Uint8Array||r instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const m=l.subarray(0,r.length);r.set(m),a(e+40,m.length),this.mem.setUint8(e+48,1)},debug:e=>{console.log(e)}}}}async run(a){if(!(a instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=a,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,globalThis,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[globalThis,5],[this,6]]),this._idPool=[],this.exited=!1;let s=4096;const n=e=>{const r=s,l=c.encode(e+"\0");return new Uint8Array(this.mem.buffer,s,l.length).set(l),s+=l.length,s%8!==0&&(s+=8-s%8),r},i=this.argv.length,o=[];this.argv.forEach(e=>{o.push(n(e))}),o.push(0),Object.keys(this.env).sort().forEach(e=>{o.push(n(`${e}=${this.env[e]}`))}),o.push(0);const u=s;o.forEach(e=>{this.mem.setUint32(s,e,!0),this.mem.setUint32(s+4,0,!0),s+=8});const d=4096+8192;if(s>=d)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(i,u),this.exited&&this._resolveExitPromise(),await this._exitPromise}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(a){const s=this;return function(){const n={id:a,this:this,args:arguments};return s._pendingEvent=n,s._resume(),n.result}}}})(),Promise.resolve();let g;const R={},H=(t,c,h)=>{g=JSON.parse(t||window.SkillTree),console.log("Loaded skill tree",g),Object.keys(g.groups).forEach(s=>{g.groups[s].nodes.forEach(i=>{const o=g.nodes[i];o.isProxy||"classStartIndex"in o||o.expansionJewel&&o.expansionJewel.parent||o.isBlighted||o.ascendancyName})}),g.skillSprites.keystoneInactive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),g.skillSprites.notableInactive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),g.skillSprites.normalInactive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),g.skillSprites.masteryInactive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),g.skillSprites.keystoneActive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),g.skillSprites.notableActive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),g.skillSprites.normalActive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),g.skillSprites.masteryInactive.forEach(s=>Object.keys(s.coords).forEach(n=>s)),JSON.parse(c||window.PassiveTranslations).forEach(s=>{s.ids.forEach(n=>{})}),Object.keys(h||window.TreeToPassive).forEach(s=>{R[(h||window.TreeToPassive)[s]]=parseInt(s)})};_({boot(t){const c=new Go;WebAssembly.instantiate(t,c.importObject).then(h=>{c.run(h.instance),H(SkillTree,PassiveTranslations,TreeToPassive)})},search(t,c){const h=ReverseSearch(t.nodes,t.stats.map(s=>s.id),t.jewel,t.conqueror,c),a={};return Object.keys(h).forEach(s=>{let n=0;const i={},o=Object.keys(h[s]).map(u=>(Object.keys(h[s][u]).forEach(d=>{var r;const e=parseInt(d);i[e]=(i[e]||0)+1,n+=((r=t.stats.find(l=>l.id==e))==null?void 0:r.weight)||0}),{passive:R[parseInt(u)],stats:h[s][u]})),f=Object.keys(h[s]).length;a[f]=[...a[f]||[],{skills:o,seed:parseInt(s),weight:n,statCounts:i}]}),Object.keys(a).forEach(s=>{const n=parseInt(s);a[n]=a[n].filter(i=>{for(const o of t.stats)if(i.statCounts[o.id]===void 0||i.statCounts[o.id]<o.min)return!1;return!0}),Object.keys(a[n]).length==0?delete a[n]:a[n]=a[n].sort((i,o)=>o.weight-i.weight)}),a}})})();
